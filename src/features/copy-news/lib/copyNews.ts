import type {News} from '../../../entities/news/model/types';

export async function copyNewsTexts(items: News[]): Promise<void> {
  const texts = items.map(n => n.text).filter((t): t is string => Boolean(t));

  const prompt = `
Забудь предыдущие переписки, обрабатывай следующий запрос с чистого листа.
У тебя есть список новостей
Проанализируй список.
Составь дайджест новостей на русском языке. Стилистика - циничная, с юмором, используй современный интернер и игровой сленг.
Объедини новости по темам (например: международные события, Израиль/Газа, происшествия, политика). Приведу примеры, как я вижу.
Пример:
Новость 1: Гранаты и взрывные устройства рядом с телами террористов: Армия обороны Израиля уничтожила 11 террористов ХАМАС в туннеле в Бейт-Хануне | Документация
Новость 2: Спикер Армии обороны Израиля подтверждает, что Армия обороны Израиля нанесла удар по двум многоэтажным зданиям, которые использовались ХАМАС в районе Газы.
Новость 3: По оценкам системы безопасности: на данный момент из города Газа эвакуировано более 300 тысяч жителей.
Ожидаемый результат: ЦАХАЛ продолжает наносить удары по инфраструктуре террористов ХАМАС, не обделяя вниманием бородачей. 11 фрагов как минимум, залутаны гранаты и взрывные устройства. Из города Газа продолжается эвакуация.
Пример2:
Новость 1: Премьер-министр Катара также заявил: «Необходимо принять конкретные меры, чтобы не допустить дальнейшего обострения ситуации со стороны Израиля. Агрессия Израиля против нашей страны является явным сигналом о том, что у него нет красных линий, сдерживающих его поведение».
Премьер-министр Катара: «Израильская атака приведет лишь к срыву попыток умиротворения. Это серьезный прецедент, с которым необходимо бороться решительно и твердо. Он не удержит нас от продолжения усилий с Египтом и США по прекращению несправедливой войны в Газе».
Ожидаемый результат: В Катаре все как обычно, будут решительно и твердо чертить красные линии. А еще угрожают сорвать переговоры по заложникам. внезапно, ага.          
Делай в соответствии с ожидаемым резыльтаом как в примерах, а именно, коротко и хлестко.
Исключи неинформативные посты (односложные подписи к фото/видео, повторяющиеся кадры, пустые новости).
Никакой отсебятины. Только тело контента.
Верни результат так же в виде массива.
Список новостей: 
 `;

  const newsAsString = texts.length
    ? texts.toString()
    : "(нет новостей)";
    console.log(texts)
    console.log(`[${newsAsString}]`)
  const finalText = `${prompt}\n\n${newsAsString}`;

  if (navigator.clipboard && navigator.clipboard.writeText) {
    await navigator.clipboard.writeText(finalText);
  } else {
    const ta = document.createElement('textarea');
    ta.value = finalText;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    try { document.execCommand('copy'); } catch { /* ignore */ }
    document.body.removeChild(ta);
  }
}
